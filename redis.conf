# Redis 서버 최적화 설정 파일
# Docker 환경에서 사용되는 Redis 설정

# 네트워크 설정
bind 0.0.0.0
port 6379
timeout 300
tcp-keepalive 300
tcp-backlog 511

# 메모리 관리
maxmemory 512mb
maxmemory-policy allkeys-lru
maxmemory-samples 5

# 지속성 설정
appendonly yes
appendfsync everysec
no-appendfsync-on-rewrite no
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb

# RDB 스냅샷 설정
save 900 1     # 900초(15분) 내에 1개 이상 변경 시 저장
save 300 10    # 300초(5분) 내에 10개 이상 변경 시 저장
save 60 10000  # 60초(1분) 내에 10000개 이상 변경 시 저장

# 데이터베이스 개수
databases 16

# 로깅
loglevel notice
logfile ""

# 클라이언트 연결 관리
maxclients 10000

# 성능 최적화
hz 10
dynamic-hz yes

# 보안 설정 (환경변수로 비밀번호 설정 가능)
# requirepass 설정은 docker-compose.yml 환경변수로 처리

# 키 만료 최적화
activerehashing yes
lazyfree-lazy-eviction yes
lazyfree-lazy-expire yes
lazyfree-lazy-server-del yes
replica-lazy-flush yes

# 커널 메모리 오버커밋 경고 무시
stop-writes-on-bgsave-error yes
rdbcompression yes
rdbchecksum yes

# 네트워크 최적화
tcp-nodelay yes